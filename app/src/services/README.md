# ๐ช Cookie Refresh Service

ุณุฑูุณ ุฎูุฏฺฉุงุฑ ุจุฑุง ุจุฑูุฒุฑุณุงู ฺฉูฺฉโูุง `marketapp.ws` ูุฑ 5 ุฏููู.

## ๐ ูฺฺฏโูุง

- **ุจุฑูุฒุฑุณุงู ุฎูุฏฺฉุงุฑ**: ูุฑ 5 ุฏููู ฺฉูฺฉโูุง ุฌุฏุฏ ุฏุฑุงูุช ูโฺฉูุฏ
- **ุฐุฎุฑู ุฏุฑ ุฏุชุงุจุณ**: ฺฉูฺฉโูุง ุฏุฑ ุฏุชุงุจุณ ุฐุฎุฑู ูโุดููุฏ
- **ุชุณุช ุฎูุฏฺฉุงุฑ**: ฺฉูฺฉโูุง ูุจู ุงุฒ ุฐุฎุฑู ุชุณุช ูโุดููุฏ
- **ูุฏุฑุช ุฎุทุง**: ุฏุฑ ุตูุฑุช ุฎุทุงุ ฺฉูฺฉโูุง ูุจู ุญูุธ ูโุดููุฏ
- **API ูุฏุฑุช**: ุงูฺฉุงู ุดุฑูุน/ุชููู ุณุฑูุณ ุงุฒ ุทุฑู API

## ๐ ูุงูโูุง

- `CookieRefreshService.ts` - ุณุฑูุณ ุงุตู
- `startCookieService.ts` - ูุฏุฑุช ุณุฑูุณ
- `cookieServiceMain.ts` - ูุงู ุงุฌุฑุง ุงุตู
- `runMigrations.ts` - ุงุฌุฑุง migration ูุง ุฏุชุงุจุณ

## ๐๏ธ ุฌุฏุงูู ุฏุชุงุจุณ

### `cookies`
ุฐุฎุฑู ฺฉูฺฉโูุง ุงุณุชุฎุฑุงุฌ ุดุฏู

### `active_cookies`
ฺฉูฺฉโูุง ูุนุงู ู ูุนุชุจุฑ

### `cookie_refresh_logs`
ูุงฺฏโูุง ุจุฑูุฒุฑุณุงู ฺฉูฺฉ

## ๐๏ธ ูุตุจ ู ุฑุงูโุงูุฏุงุฒ

### 1. ูุตุจ ูุงุจุณุชฺฏโูุง
```bash
npm install
```

### 2. ุงุฌุฑุง Migration
```bash
npm run migrate
```

### 3. ุดุฑูุน ุณุฑูุณ
```bash
npm run cookie-service
```

## ๐ง API Endpoints

### ูุฏุฑุช ุณุฑูุณ
```
POST /api/admin/cookie-service
```

**Actions:**
- `start` - ุดุฑูุน ุณุฑูุณ
- `stop` - ุชููู ุณุฑูุณ
- `status` - ูุถุนุช ุณุฑูุณ
- `refresh` - ุจุฑูุฒุฑุณุงู ููุฑ

**ูุซุงู:**
```bash
curl -X POST http://localhost:6592/api/admin/cookie-service \
  -H "Content-Type: application/json" \
  -d '{"action": "start"}'
```

## ๐ ุงุณุชูุงุฏู ุฏุฑ ฺฉุฏ

### ุฏุฑุงูุช ฺฉูฺฉโูุง ุงุฒ ุฏุชุงุจุณ
```typescript
import { getCurrentCookies, getCookieStringFromDB } from '../utils/cookieManager';

// ุฏุฑุงูุช ฺฉูฺฉโูุง ุจู ุตูุฑุช object
const cookies = await getCurrentCookies();

// ุฏุฑุงูุช ฺฉูฺฉโูุง ุจู ุตูุฑุช string
const cookieString = await getCookieStringFromDB();
```

## ๐ ูุฑุขูุฏ ฺฉุงุฑ

1. **ุดุฑูุน ุณุฑูุณ**: Browser ุฑุงูโุงูุฏุงุฒ ูโุดูุฏ
2. **ุฑูุชู ุจู ุณุงุช**: `marketapp.ws` ุจุงุฒ ูโุดูุฏ
3. **ุงุณุชุฎุฑุงุฌ ฺฉูฺฉโูุง**: ฺฉูฺฉโูุง ุฌุฏุฏ ุงุณุชุฎุฑุงุฌ ูโุดููุฏ
4. **ุชุณุช ฺฉูฺฉโูุง**: API ูุง ูุฎุชูู ุชุณุช ูโุดููุฏ
5. **ุฐุฎุฑู ุฏุฑ ุฏุชุงุจุณ**: ฺฉูฺฉโูุง ูุนุชุจุฑ ุฐุฎุฑู ูโุดููุฏ
6. **ุงูุชุธุงุฑ**: 5 ุฏููู ุตุจุฑ ูโฺฉูุฏ
7. **ุชฺฉุฑุงุฑ**: ูุฑุขูุฏ ุชฺฉุฑุงุฑ ูโุดูุฏ

## โ๏ธ ูฺฉุงุช ููู

- ุณุฑูุณ ุฏุฑ ุญุงูุช `headless` ุงุฌุฑุง ูโุดูุฏ
- ุฏุฑ ุตูุฑุช ุฎุทุงุ ฺฉูฺฉโูุง ูุจู ุญูุธ ูโุดููุฏ
- ูุงฺฏโูุง ฺฉุงูู ุฏุฑ console ููุงุด ุฏุงุฏู ูโุดููุฏ
- ุณุฑูุณ ุจุง `Ctrl+C` ูุชููู ูโุดูุฏ

## ๐ ุนุจโุงุจ

### ุจุฑุฑุณ ูุถุนุช ุณุฑูุณ
```bash
curl http://localhost:6592/api/admin/cookie-service
```

### ุจุฑุฑุณ ูุงฺฏโูุง
```sql
SELECT * FROM cookie_refresh_logs ORDER BY createdAt DESC LIMIT 10;
```

### ุจุฑุฑุณ ฺฉูฺฉโูุง ูุนุงู
```sql
SELECT * FROM active_cookies WHERE testResult = TRUE;
```